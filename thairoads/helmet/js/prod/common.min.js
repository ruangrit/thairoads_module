window.getCurrentLayers=function(a){return _.pluck($(a+" div.selected"),"value")};window.CreateLayerManager=function(e,g){var b={},d={funcs:b},a=[],c=[],f=function(j,h){j=["2531","2534","2546","2555"].sort().reverse();var i=_.find(j,function(k){return parseInt(k,10)<=parseInt(h,10)});return(i||2531).toString()};d.set_baseLayer=function(h){a=h;return d};d.set_basePrefix=function(h){c=h;return d};d.set_fallbackPrefix=function(h){f=h};_.each(e,function(i,h){var j=h.split("-")[0],l={};l[h]=(function(){var k=i,m={layer:h.split("-").slice(1).join("-")||"no",year:j,hide:function(){$(k).hide()},show:function(){$(k).show()},data:function(){return k}};m.hide();return m})();_.extend(b,l)});d.show=function(k,i,m){var j=c;var h=_.union(a,i);j=_.union(c,(k).toString(),f([],k));var l=_.filter(b,function(o,n){return _(j).contains(o.year)&&_.contains(h,o.layer)});_.each(g,function(n){n.hide()});g=l;_.each(l,function(n){n.show()});return d};d.hide=function(){_.each(g,function(h){h.hide()})};d.getAllLayers=function(){return _.clone(["accident","พท-เกษตรกรรม","อาศัย","พท-อนุรักษ์","อุตสาหกรรมคลังสินค้า","ราชการ","อุตสาหกรรมไม่ก่อมลพิษ","พท-โล่งเพื่อนันทนาการ"])};return d};var snapYear=function(a){return _.find(["2520","2523","2529","2531","2534","2535","2538","2539","2540","2543","2544","2539","2551","2553","2549"].sort().reverse(),function(b){return b<=a})};window.buildincidentHTML=function(i,f){var j={"graph-Event":" ","graph-Accident":"/"};var d=_.template("<div class='event-<%= type %>'>        <div class='incident-year'> <%= incident_year %> </div>        <ul id='incident-<%= type %>'>");var h=_.template(" <li>                                    <div class='time'><%= date %></div>                                    <div class='incident'> <%= incident %> </div>                                    <div class='detail'>                                    <% if (type=='graph-Accident') { %>                                         <span>สถานที่&nbsp;:&nbsp;</span> <%= location %><br />                                        <span>ผลกระทบ&nbsp;:&nbsp;</span> <%= effect %>                                    <% } %>                                    </div>                                </li>");var c=window[f+"List"];var a;var g="";var e=c[i].year;var b="";if(!_.isUndefined(c)){_.each(c[i],function(m,l){_.extend(m,{type:f,incident_year:e});a=d(m);g+=h(m);g+=build_with_image(f,e,m.date)})}d=a+g+"</ul></div>";return d};window.build_with_image=function(d,c,a){var b="";var f=_.template("<div class='info-item'>                                         <img class='info-image' src='images/info_image/<%= filename %>'>                                        <p class='info-text'><%= info %></p>                                     </div>");var e=_.find(graph_bubble_info[c],function(g){return g.date==a});if(e&&d==="graph-Event"){b+="<div class='info-wrapper'>";b+=f(e);b+="</div>";return b}else{return""}};function bind_bubbleEvent(c,a){var b=function(f,e){var i,h,g;$(f).mouseenter(function(l){var k=$(this),j=k.parent();i=new Date();l.stopPropagation();if(_.isUndefined(j.attr("id"))){k.css({opacity:1,cursor:"pointer"});h=k.parent().parent().parent().attr("id");g=k.parent().parent();g.animate({opacity:1},0)}else{g=undefined}a.hide();a.eq(e).fadeIn()}).click(function(n){var m=window[h+"List"];var l=$(this).parent(),o=l.attr("id");if(_.isUndefined(o)){var k=buildincidentHTML(e,h);var j=(k.length)/2;$.colorbox({html:buildincidentHTML(e,h),width:"600px",opacity:0.82,height:(j>600?600:j)+"px"})}}).mouseleave(function(o){var k=new Date(),n=k-i;var m=$(this);if(n>80){setTimeout(function j(){if(g){g.animate({opacity:0.5})}a.eq(e).fadeOut()},200)}else{setTimeout(function l(){if(g){g.animate({opacity:0.5})}a.eq(e).fadeOut()},300)}})};var d=$("circle",c);_.each(d,function(f,e){b(f,e)})}function buildPMInfo(e){var c=pmList[e];var b="<ul>";var a=_.template("<li><div class='time'><%= date %></div> <div class='data-year'><%= incident %></div> </li>");_.each(c.events,function(g){b+=a(g)});b+="</ul>";var d=_.template("<div class='primebox'>                                     <img src='asset/primeminister/<%= year %>-primeMinister.png'/>                                     <div class='fullname'>                                         <%= fullname %>                                     </div>                                     <div class='-bubbleldyear'> <%= hold_years %> </div>                                     <p class='events'>  <%= events_html %> </p>                                 </div>");var f={fullname:c.fullname,hold_years:c.hold_years,year:e,events_html:b};return d(f)}var createControlButton=function(b,a,d,c){_.each(b,function(h,g){var f="layer"+g;var e=c||"";if(e.length){e=c+"-"}elm=$("<div></div>").attr({id:e+f.toString(),value:h.key,"class":h["class"],selected:true,title:h.text}).css({"float":"left",width:"76px",height:"36px"});elm.addClass("selected");elm.mouseenter(function(i){$(this).css({opacity:1,cursor:"pointer"})});elm.click(function(k){var j=$(this);var i=j.attr("selected");if(i){j.removeClass("selected")}else{j.addClass("selected")}$(this).attr("selected",!i);if(_.isFunction(d)){d()}});elm.tipsy({className:e+"class "+h["class"]+"-subclass",gravity:h.tipsyGravity});a.append(elm)})};