$(function(){var c=function(f){var e=$("#svgload").svg({width:300,height:200});e.load("map-test.svg","get",function(g){var j=[];var i=$("svg > g",$("#svgload"));var h=_.groupBy(i,function(l){return l.id.split("_")[0]||"other"});var k=CreateLayerManager(h,j).set_baseLayer(["road","area","accident","cityPlan"]).set_basePrefix(["other","all"]);f(null,k)})};var d=function(f){var e=$("#svggraph").svg();e.load("graph.svg?"+Math.random(),"get",function(g){var k=$("svg > g",$("#svggraph"));var j=[];var i=_.groupBy(k,function(l){return l.id.split("_")[0]||"other"});var h=CreateLayerManager(i,j);h.set_fallbackPrefix(function(){return""});f(null,h)})};var b=function(h){var g=[];var f=_.groupBy($("#graph-overlay g"),function(j){return j.id.split("_")[0]||"other"});var e=CreateLayerManager(f,g);e.set_fallbackPrefix(function(){return""});return e};var a=function(e){var f='<div class="teaser">            <span>กำเนิดของนิคมอุตสาหกรรมมาบตาพุดนับเป็นก้าวสำคัญของการพัฒนาอุตสาหกรรมไทย</span>            แต่ตลอดระยะเวลาสามสิบปีที่ผ่านมา            การพัฒนานิคมแห่งนี้ถูกตั้งคำถามจากผู้มีส่วนได้เสีย โดยเฉพาะชุมชนโดยรอบ            มากขึ้นเรื่อยๆ จนกลายเป็นคดีประวัติศาสตร์ว่า            ภาคธุรกิจและรัฐแสดงความรับผิดชอบต่อปัญหาด้านความปลอดภัย มลพิษ            และปัญหาสังคมในพื้นที่อย่างไร ไทยพับลิก้าชวนทุกท่านร่วมกันประเมินอดีต            ปัจจุบัน เพื่อครุ่นคิดถึงอนาคตของมาบตาพุด ในอินเทอร์แอคทีฟ <strong>"30 ปี มาบตาพุด"</strong>            </div>';$.colorbox({html:f,width:"800px",opacity:0.82,height:"340px"});e(null,"done")};async.parallel([c,d,a],function(h,g){var f={globalize:function(i){i(null,"done")},hook_startup:function(i){i(null,"first")},bind_bubbleEvents:function(i){bind_bubbleEvent(LayerManager2.funcs["graph-Factory"].data(),jQuery('[id$="factoryBubble"]'));bind_bubbleEvent(LayerManager2.funcs["graph-GPP"].data(),jQuery('[id$="gppBubble"]'));bind_bubbleEvent(LayerManager2.funcs["graph-Accident"].data(),jQuery('[id$="accidentBubble"]'));bind_bubbleEvent(LayerManager2.funcs["graph-Event"].data(),jQuery('[id$="event"]'));bind_bubbleEvent(LayerManager2.funcs["graph-people"].data(),jQuery('[id$="people-bubble"]'));bind_bubbleEvent(LayerManager2.funcs["graph-peopleHide"].data(),jQuery('[id$="peopleHide-bubble"]'));i(null,"done")},bind_graphEvents:function(i){var j={"z-index":500,opacity:0,width:"32",height:"32",background:"red",position:"absolute",top:"21px","float":"left"};_.each(pm_face_position,function(m,l){$("#slider-range-max > div").append($("<div>").attr({id:l}).css(j).css(m))});$('div[id$="primeMinister"]').mouseover(function(l){$(this).css({cursor:"pointer"});var m=$(this).attr("id").split("-")[0],k=pmList[m]?pmList[m]["fullname"]:"";$(this).tipsy({className:"prime-minister-tipsy",gravity:"n",fallback:"รัฐบาล "+k}).tipsy("show")}).mousedown(function(m){m.stopPropagation();var n=$(this).attr("id").split("-")[0],l=buildPMInfo(n),k=(l.length)/2;k-=55*(Math.log(k)-5);$.colorbox({html:l,width:"600px",opacity:0.82,height:(k>600?600:k)+"px"})});i(null,"done")},create_graph_and_map_controller:function(j){var i=[{key:"Factory","class":"factory",text:"โรงงาน",tipsyGravity:"e"},{key:"Accident","class":"accident",text:"อุบัติเหตุ",tipsyGravity:"e"},{key:"Event","class":"event",text:"เหตุการณ์",tipsyGravity:"e"},{key:"GPP","class":"gpp",text:"จีพีพี (ผลิตภัณฑ์มวลรวมจังหวัด)",tipsyGravity:"e"},{key:"people","class":"people",text:"ประชากรท้องถิ่น",tipsyGravity:"e"},{key:"peopleHide","class":"peopleHide",text:"ประชากรแฝง",tipsyGravity:"e"}];var k=[{key:"อาศัย","class":"home",text:"พื้นที่ที่อยู่อาศัย",tipsyGravity:"e"},{key:"อุตสาหกรรมคลังสินค้า","class":"factory",text:"พื้นที่อุตสาหกรรมหรือคลังสินค้า",tipsyGravity:"e"},{key:"พท-เกษตรกรรม","class":"agriculture",text:"พื้นที่เกษตรกรรม",tipsyGravity:"e"},{key:"อุตสาหกรรมไม่ก่อมลพิษ","class":"green-factory",text:"พื้นที่อุตสาหกรรมที่ไม่ก่อมลพิษ",tipsyGravity:"e"},{key:"พท-อนุรักษ์","class":"environment",text:"พื้นที่อนุรักษ์",tipsyGravity:"e"},{key:"ราชการ","class":"government",text:"พื้นที่ราชการ",tipsyGravity:"e"}];var l=LayerManager.getAllLayers("#map-control");createControlButton(k,$("#map-control"),function(){LayerManager.show(window.currentYear||2531,getCurrentLayers("#map-control"))},"area-filter");createControlButton(i,$("#graph-control"),function(){LayerManager2.show("graph",getCurrentLayers("#graph-control"))},"graph-filter");j(null,"done")},bind_click_accident_map:function(i){$('image[id*="accident"]').mouseenter(function(k){$(this).css({cursor:"pointer"})}).click(function(){var r=$(this);var x=r.attr("id").split("accident")[1];var p=parseInt(x,10)-1;var v=_.template("<div class='accident-map'>                                                         <div class='acc_date'> <%= date %> </div>                                                         <div class='acc_desc'> <%= incident %> </div>                                                         <div class='acc_loc'><span>สถานที่: </span> <%= location %> </div>                                                        <div class='acc_eff'><span>ผลกระทบ: </span> <%= effect %> </div>                                                   </div>");var l={"2540":[{filename:"2540-01juneAccident.png",info:"วันที่ 23 มิย. 40 เกิดปัญหามลพิษทางอากาศ นักเรียนรร.มาบตาพุดพันพิทยาคารนับร้อยถูกหามส่งรพ."}],"2547":[{filename:"2547-02decAccident.png",info:"วันที่ 3 ธค. 47 เพลิงไหม้โกดังเก็บวัตถุดิบสำหรับผลิตพีวีซีหรือพลาสติกแผ่นแข็ง โรงงานซีพีเจริญโภคภัณฑ์ปิโตรเคมี จำกัด กิงอำเภอนิคมพัฒนา จ. ระยอง"}],"2555":[{filename:"2555-03decAccident.png",info:"วันที่ 5 ธค. 55 เหตุเพลิงไหม้โรงงานบ.บีเอสที อิลาสโตเมอร์ส จำกัด"}]};var s=_.first(r.parent().attr("id").split("-"));var t=$('image[id*="accident"]',r.parent());var k=_.filter(_.collect(t,function(y){return y.id}),function(y){return y.indexOf("Img")===-1});var w=r.attr("id").replace("Img-","");var u=_.indexOf(k,w);var n=accident_on_graph[s][u];var o=v(n);var m=_.template("<div class='info-item'>                                                         <img class='info-image' src='images/info_image/<%= filename %>'>                                                        <p class='info-text'><%= info %></p>                                                     </div>");var q=0;if(l[s]){o+="<div class='info-wrapper accident'>";_.each(l[s],function(y){o+=m(y)});o+="</div>";q+=310}$.colorbox({html:o,opacity:0.8,width:"560px",height:((300+q)).toString()+"px"})});var j='<div class="howtouse">                                <h3> วิธีการใช้: </h3>                                 <ol>                                    <li>เลื่อนกรอบเวลาสีฟ้าในแกน X เพื่อดูผังเมืองและจุดเกิดอุบัติภัยในปีต่างๆ</li>                                    <li>คลิกสัญลักษณ์ต่างๆ ทางด้านขวามือ เพื่อ toggle ปิดหรือเปิดชุดข้อมูล</li>                                    <li>วางเมาส์และคลิกจุดต่างๆ ในกราฟและผังเมือง เพื่อดูรายละเอียดของเหตุการณ์</li>                                    <li>คลิกรูปนายกรัฐมนตรี เพื่ออ่านนโยบายสำคัญๆ ที่เกี่ยวข้องกับมาบตาพุด</li>                                </ol>                            </div>';$(".information").mouseover(function(k){$(this).css({cursor:"pointer"})}).mousedown(function(k){$.colorbox({html:j,width:"600px",opacity:0.82,height:"300px"})});i(null,"done")},bind_event_to_slider:function(j){var i=[];$("#slider-range-max").slider({value:window.currentYear,min:2520,max:2555,step:1,animate:false,slide:function(n,p){var q=$("#amount").val(p.value);window.currentYear=p.value;var k=getCurrentLayers("#map-control");var m=p.value;var o=$("#"+m+"-accident",LayerManager2.funcs["graph-Accident"].data()).eq(0);var l=$("#"+m+"-event_",LayerManager2.funcs["graph-Event"].data()).eq(0);LayerManager.show(window.currentYear,k);guideManager.show(currentYear,["graphOverlay"]);$.each(i,function(s,r){r.css({opacity:"0.5"})});o.css("opacity",1);l.css("opacity",1);i.push(o,l)}});$("#amount").val($("#slider-range-max").slider("value"));j(null,"ok")},remove_indicator_and_show_slider:function(i){$("div.preloader").remove();$("div#slider-wrapper").show();i(null,"ok")},show_graph_and_map:function(j){var i=getCurrentLayers("#map-control");LayerManager.show(currentYear,i);LayerManager2.show("graph",["Factory","Accident","Event","GPP","people","peopleHide"]);$("#graph-overlay").show();guideManager.show(currentYear,["graphOverlay"]);j(null,"ok")}};if(!h){window.currentYear=2553;window.LayerManager=g[0];window.LayerManager2=g[1];window.guideManager=b();async.series(f,function e(j,i){})}})});